<button onclick="toggleChatAdmin()" id="btn-chat-flotante" class="btn btn-warning shadow-lg rounded-circle position-fixed d-flex align-items-center justify-content-center" style="bottom: 30px; right: 30px; width: 65px; height: 65px; z-index: 1000; border: 3px solid white;">
        <i class="fa-solid fa-comments fa-xl text-dark"></i>
        {% if not_read_count > 0 %}
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light">
            {{ not_read_count }}
        </span>
        {% endif %}
    </button>

    <div id="ventana-chat-admin" class="card shadow-lg position-fixed d-none" style="bottom: 110px; right: 30px; width: 380px; z-index: 1000; border-radius: 15px; border: none; display: flex; flex-direction: column; overflow: hidden;">
        
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center fw-bold p-3">
            <span><i class="fa-solid fa-headset me-2"></i> Soporte Admin</span>
            <button onclick="toggleChatAdmin()" type="button" class="btn-close btn-sm"></button>
        </div>

        <div class="card-body bg-light overflow-auto p-3" style="height: 350px; display: flex; flex-direction: column;">
            
            {% if mensajes_chat %}
                {% for msg in mensajes_chat %}
                    <div class="d-flex mb-3 {% if msg.sender == user %}justify-content-end{% else %}justify-content-start{% endif %}">
                        
                        <div class="p-2 px-3 shadow-sm" 
                             style="max-width: 80%; border-radius: 15px; 
                                    {% if msg.sender == user %}
                                        background-color: #dcf8c6; border-bottom-right-radius: 0;
                                    {% else %}
                                        background-color: white; border-bottom-left-radius: 0;
                                    {% endif %}">
                            
                            <small class="d-block fw-bold mb-1 {% if msg.sender == user %}text-success text-end{% else %}text-primary{% endif %}" style="font-size: 0.7rem;">
                                {% if msg.sender == user %} TÃº {% else %} Admin {% endif %}
                            </small>
                            
                            <span class="text-dark">{{ msg.mensaje }}</span>
                            
                            <small class="d-block text-muted mt-1 text-end" style="font-size: 0.65rem;">
                                {{ msg.fecha|date:"H:i" }}
                            </small>
                        </div>

                    </div>
                {% endfor %}
                
                <div id="final-chat"></div>

            {% else %}
                <div class="text-center text-muted my-auto">
                    <i class="fa-regular fa-paper-plane fa-3x mb-3 text-secondary opacity-50"></i>
                    <p class="small">Escribe al administrador si tienes dudas.</p>
                </div>
            {% endif %}
        </div>

        <div class="card-footer bg-white p-2">
            <form action="{% url 'asesor_enviar_mensaje' %}" method="POST" class="d-flex gap-2">
                {% csrf_token %}
                <input type="text" name="mensaje" class="form-control border-0 bg-light" placeholder="Escribe un mensaje..." required style="border-radius: 20px;">
                <button type="submit" class="btn btn-warning rounded-circle text-white shadow-sm" style="width: 40px; height: 40px;">
                    <i class="fa-solid fa-paper-plane text-dark small"></i>
                </button>
            </form>
        </div>
    </div>

    <script>
        function toggleChatAdmin() {
            var ventana = document.getElementById("ventana-chat-admin");
            if (ventana.classList.contains("d-none")) {
                ventana.classList.remove("d-none");
                // Auto-scroll al final
                var objDiv = document.querySelector(".card-body");
                objDiv.scrollTop = objDiv.scrollHeight;
            } else {
                ventana.classList.add("d-none");
            }
        }
    </script>