{% extends 'core/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold"><i class="fa-solid fa-screwdriver-wrench"></i> Panel de Administración</h2>
        <div>
            <a href="{% url 'dashboard_financiero' %}" class="btn btn-primary fw-bold">
                <i class="fa-solid fa-chart-line"></i> Ver Dashboard Financiero
            </a>
            <a href="{% url 'inicio' %}" class="btn btn-outline-dark ms-2">Volver al sitio web</a>
        </div>
    </div>

    <div class="card shadow-sm mb-4 border-warning">
        <div class="card-header bg-warning text-dark fw-bold">
            <i class="fa-solid fa-bell"></i> Solicitudes Pendientes ({{ pendientes_count }})
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Título Profesional</th>
                            <th>CV</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for perfil in solicitudes %}
                        <tr>
                            <td>
                                <div class="fw-bold">{{ perfil.user.first_name }} {{ perfil.user.last_name }}</div>
                                <small class="text-muted">{{ perfil.user.email }}</small>
                            </td>
                            <td>{{ perfil.public_title }}</td>
                            <td>
                                {% if perfil.cv_file %}
                                    <a href="{{ perfil.cv_file.url }}" target="_blank" class="btn btn-sm btn-info text-white">
                                        <i class="fa-solid fa-file-pdf"></i> Ver CV
                                    </a>
                                {% else %}
                                    <span class="text-muted">Sin CV</span>
                                {% endif %}
                            </td>
                            <td class="text-end">
                                <a href="{% url 'aprobar_asesor' perfil.id %}" class="btn btn-success btn-sm fw-bold">
                                    <i class="fa-solid fa-check"></i> Aceptar
                                </a>
                                <a href="{% url 'rechazar_asesor' perfil.id %}" class="btn btn-danger btn-sm fw-bold ms-1" onclick="return confirm('¿Borrar esta solicitud?')">
                                    <i class="fa-solid fa-xmark"></i> Rechazar
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">
                                No hay solicitudes pendientes.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-4 border-success">
        <div class="card-header bg-success text-white fw-bold">
            <i class="fa-solid fa-check-circle"></i> Asesores Activos ({{ asesores|length }})
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Asesor</th>
                            <th>Precio Hora</th>
                            <th>Duración</th>
                            <th>Resumen</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asesor in asesores %}
                        <tr>
                            <td>
                                <div class="fw-bold">{{ asesor.user.first_name }} {{ asesor.user.last_name }}</div>
                                <span class="badge bg-light text-dark border">{{ asesor.public_title }}</span>
                            </td>
                            <td>${{ asesor.hourly_rate }}</td>
                            <td>{{ asesor.session_duration }} min</td>
                            <td>
                                <small class="text-muted">{{ asesor.experience_summary|truncatechars:50 }}</small>
                            </td>
                            <td class="text-end">
                                <a href="{% url 'admin_editar_precio' asesor.id %}" class="btn btn-outline-primary btn-sm" title="Editar Precio">
                                    <i class="fa-solid fa-dollar-sign"></i>
                                </a>
                                <a href="{% url 'admin_editar_duracion' asesor.id %}" class="btn btn-outline-secondary btn-sm" title="Editar Tiempo">
                                    <i class="fa-solid fa-clock"></i>
                                </a>
                                <a href="{% url 'admin_enviar_observacion' asesor.id %}" class="btn btn-outline-warning btn-sm" title="Enviar Observación">
                                    <i class="fa-solid fa-envelope"></i>
                                </a>
                                <a href="{% url 'rechazar_asesor' asesor.id %}" class="btn btn-outline-danger btn-sm" onclick="return confirm('¿Eliminar a este asesor?')">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">
                                No hay asesores activos.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-danger">
        <div class="card-header bg-danger text-white fw-bold">
            <i class="fa-solid fa-triangle-exclamation"></i> Reclamos y Solicitudes de Reembolso
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID Cita</th>
                            <th>Cliente</th>
                            <th>Asesor Acusado</th>
                            <th>Motivo del Reclamo</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reclamo in reclamos %}
                        <tr class="table-danger">
                            <td>#{{ reclamo.id }}</td>
                            <td>{{ reclamo.client.first_name }} {{ reclamo.client.last_name }}</td>
                            <td>{{ reclamo.asesor.user.first_name }}</td>
                            <td>{{ reclamo.reclamo_mensaje }}</td>
                            <td class="text-end">
                                <a href="{% url 'resolver_reclamo' reclamo.id 'aprobar' %}" class="btn btn-success btn-sm">
                                    Reembolsar
                                </a>
                                <a href="{% url 'resolver_reclamo' reclamo.id 'rechazar' %}" class="btn btn-dark btn-sm">
                                    Ignorar
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">
                                ✨ No hay reclamos pendientes. Todo funciona bien.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
{% endblock %}